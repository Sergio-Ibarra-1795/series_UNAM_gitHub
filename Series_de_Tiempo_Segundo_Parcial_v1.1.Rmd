---
title: "Series_de_Tiempo_Segundo_Parcial_v1.1"
author: "Sergibar"
date: "2023-06-01"
output: html_document
---



# Universidad Nacional Autónoma de México 
# Posgrado en Ingeniería de Sistemas 
# Series de tiempo Dr. Wulfrano Gomez Gallardo 
# Segundo Parcial: Aplicaicón de métodos ARIMA / SARIMA para pronóstico de series de tiempo (3 casos aplicativos)


# Serie de tiempo 1 SIN tendencia y SIN estacionalidad: Historico anual Accidentes terrestres en México

Tenemos data anual desde 2005 a 2021 sobre el número de accidentes terrestres que ha habido en México, son 22 datos en total. 
La idea es usar 19 de esos 22 datos como una especie de "data de entrenamiento" para aplicar los modelos A) ARIMA y B) SARIMA para posteriormente predecir con cada modelo los valores de los 3 años restantes y poder comparar contra los reales e identificar el mejor entre los dos mencionados para modelar los accidentes terrestres en México 



Primero importamos la data de Accidentes terrestres en MEX
Data obtenida de la página oficial del INEGI:  https://www.inegi.org.mx/temas/accidentes/

```{r}
library("readxl")


Accidentes_transito_MEX <-read_excel("Accidentes_transito_full_.xlsx")
```


Revisamos que la data de Accidentes_transitos MEX se haya importado correctamente 
```{r}
Accidentes_transito_MEX
summary(Accidentes_transito_MEX)
typeof(Accidentes_transito_MEX)
dim(Accidentes_transito_MEX)
```


#### Convertimos los data importada a Serie de tiempo


```{r}

Accidentes_transito_MEX_ts<- ts(Accidentes_transito_MEX$Num, frequency = 1)
head(Accidentes_transito_MEX_ts)
typeof(Accidentes_transito_MEX_ts)

```


Graficamos la serie del tiempo
```{r}
plot(Accidentes_transito_MEX_ts, col = "red", main = "Data historica anual de accidentes de transito en México de 2005 a 2021", ylab="Número de accidentes")

```



### Analicemos los valores de la variable y 

```{r}
hist(Accidentes_transito_MEX_ts)
```



```{r}
summary(Accidentes_transito_MEX_ts)
```


```{r}

library(e1071)

# Calculate skewness
skewness_value <- skewness(Accidentes_transito_MEX_ts)

# Calculate kurtosis
kurtosis_value <- kurtosis(Accidentes_transito_MEX_ts)

# Print the results
print(paste("Skewness:", skewness_value))
print(paste("Kurtosis:", kurtosis_value))

```


Se observa que la gran mayoria de los valores de la variable Y (número de accidentes terrestres anuales en México) están en el intervalo de [350,000 a 400,000] y que la variable sigue una distribución ´de tipo normal´ pero con "skewness" hacia la cola derecha  


#### Separamos el en data sets train y test

Se tienen 22 datos, por lo que el train será de 19 datos, para que el test sea de 3 datos o 3 años 

```{r}

# Split the data into training and testing sets


# Subset the data to keep rows from the beginning until train_end and all columns
Accidentes_transito_MEX_ts_train <- Accidentes_transito_MEX_ts[1:19]
head(Accidentes_transito_MEX_ts_train)
tail(Accidentes_transito_MEX_ts_train)


```



```{r}
# Subset the data to keep rows from the beginning until train_end and all columns


# Subset the data to keep rows from the beginning until train_end and all columns
Accidentes_transito_MEX_ts_test <- Accidentes_transito_MEX_ts[20:22]
head(Accidentes_transito_MEX_ts_test)
tail(Accidentes_transito_MEX_ts_test)

```




## Modelo SARIMA para Serie 1 (Accidentes terrestres en México)


#### Determinación de ACF & PACF para el caso de la serie 1 (Accidentes transitos Mex) sin diferneciar 

```{r}
#install.packages("forecast")
library(forecast)

#par(mfrow=c(2,1))

acf_Accidentes_transito_MEX_ts_sin_diferenciar <- Acf(Accidentes_transito_MEX_ts, lag.max = 100, ci.type = "ma")
acf_Accidentes_transito_MEX_ts_sin_diferenciar


pacf_Accidentes_transito_MEX_ts_sin_diferenciar <- Pacf(Accidentes_transito_MEX_ts, lag.max = 100, ci.type = "ma")
pacf_Accidentes_transito_MEX_ts_sin_diferenciar

```

La función ACF de la serie, nos refleja la forma 'original' de la serie donde los primeros años hay una tendencia  creciente y posteriormente una decreciente. El hecho de que la serie muestra varios valores significativos para la gráfica de ACF sugiere que No es una serie estacionaria, para estar 100% seguros heremos un test de Dickey-Fuller  



#### Se lleva a cabo el tet de Dickey-Fulley (Ho: Serie no estacionaria) de la serie 1 (Accidentes transitos Mex)  <sin diferenciar>

```{r}
# Install and load the "urca" package
#install.packages("urca")
library(urca)

# Perform ADF test for stationarity
acf_test_Accidentes_transito_MEX_ts_sin_diferenciar <- ur.df(Accidentes_transito_MEX_ts)

# Print the ADF test results
summary(adf_test_Accidentes_transito_MEX_ts_sin_diferenciar)

```
Se observa como el valor p de la prueba DF de estacionariedad p> 0.05 por lo tanto NO se rechaza Ho que indica que la serie no es estacionaria. 


Para intentar "hacer estacionaria la serie vamos a tomar la primer diferencia de Yt con Yt-1"


#### Vamos a diferenciar la serie 1 (Accidentes transitos Mex) 'para hacerlo estacionaria'

```{r}
# Calculate the difference between consecutive elements
Accidentes_transito_MEX_ts_diferencia1 <- diff(Accidentes_transito_MEX_ts, differences = 1)

# Print the results
print(Accidentes_transito_MEX_ts_diferencia1)

```



#### ACF & PACF para los la serie 1 (Accidentes transitos Mex) diferencia1  'estacionariazada'


```{r}
library(forecast)

#par(mfrow=c(2,1))

acf_test_Accidentes_transito_MEX_ts_diferencia1 <- Acf(Accidentes_transito_MEX_ts_diferencia1, lag.max = 100, ci.type = "ma")
acf_test_Accidentes_transito_MEX_ts_diferencia1


pacf_test_Accidentes_transito_MEX_ts_diferencia1 <- Pacf(Accidentes_transito_MEX_ts_diferencia1, lag.max = 100, ci.type = "ma")
pacf_test_Accidentes_transito_MEX_ts_diferencia1
```


Todo indica que la primer diferenciación de la seria ayudó a hacerla estacionaria. Se hace nuevamente una prueba de Dickey-Fulley para verificar estacionariedad 


#### Se lleva a cabo el tet de Dickey-Fulley (Ho: Serie no estacionaria) a la serie 1  <diferenciar 1>

```{r}
# Install and load the "urca" package
#install.packages("urca")
library(urca)

# Perform ADF test for stationarity
acf_test_Accidentes_transito_MEX_ts_diferencia1 <- ur.df(Accidentes_transito_MEX_ts_diferencia1)

# Print the ADF test results
summary(acf_test_Accidentes_transito_MEX_ts_diferencia1)

```
Con un valor de p<0.05 se comprueba que la serie 1 (Accidentes transitos Mex) con 1 diferencia ya es estacionaria. 

Con base en las gráficas de ACF y PACF (y teniendo en cuenta el principio de parcimonia) se decide probar un modleo ARIMA (1,1,1)


#### Ajustae y predicicon de para serie 1 (Accidentes transitos Mex) con modelo ARIMA 


```{r}
#install.packages("astsa")
library(astsa)

# Fit the SARIMA model
ARIMA_1_1_1_Accidentes_transito_Mex <- astsa::sarima(Accidentes_transito_MEX_ts_train , p=1, d=1, q=1)

# Print the model summary
summary(ARIMA_1_1_1_Accidentes_transito_Mex)

```
En general se observa para el modelo ARIMA_1_1_1_Accodentes_transito_Mex: 

Los errores estandarizados tienen un compartiempo aprorximadamente normal con media cero 
Los errores estandarizados no tiene una correlación signifcativa


#### Calculo de predicción para serie 1 (Accidentes transitos Mex) con modelo ARIMA

```{r}

# Get the predictors


pred_ARIMA_1_1_1_Accidentes_transito_Mex <- sarima.for(Accidentes_transito_MEX_ts_train, n.ahead=3,1,1,1)
pred_ARIMA_1_1_1_Accidentes_transito_Mex


```




```{r}
pred_ARIMA_1_1_1_Accidentes_transito_Mex$pred
```




#### Calculo de errores del modelo ARIMA para serie 1 (Accidentes transitos Mex)

```{r}
accuracy(Accidentes_transito_MEX_ts_test ,pred_ARIMA_1_1_1_Accidentes_transito_Mex$pred )
```

El MAPE del modelo ARIMA 1,1,1 para la serie 1 (Accidentes transitos Mex) es de ~5.3% 




#### Ajustae y predicicon con modelo SARIMA para serie 1 (Accidentes transitos Mex) 


```{r}
#install.packages("astsa")
library(astsa)

# Fit the SARIMA model
SARIMA_Accidentes_transito_Mex <- Arima(Accidentes_transito_MEX_ts_train, order = c(1, 1, 1), seasonal = list(order = c(1, 0, 0), period = 1))

# Print the model summary
summary(SARIMA_Accidentes_transito_Mex)

```


#### Calculo de predicción del SARIMA para serie 1 (Accidentes transitos Mex) 

```{r}

# Get the predictors


pred_SARIMA_Accidentes_transito_Mex <- forecast(SARIMA_Accidentes_transito_Mex, h = 3)
pred_SARIMA_Accidentes_transito_Mex


```




```{r}
pred_SARIMA_Accidentes_transito_Mex$mean
```




#### Calculo de errores del modelo SARIMA para serie 1 (Accidentes transitos Mex) 

```{r}
accuracy(Accidentes_transito_MEX_ts_test ,pred_SARIMA_Accidentes_transito_Mex$mean )
```

El MAPE del modelo SARIMA 1,1,1 (1,0,0) S=1 es de ~4.5%. Lo que indica y en este caso comprueba que diferenciar la serie para hacerla estacionaria, en general mejora los pronósticos en los modelos ARIMA




# Serie de tiempo 2 CON tendencia y SIN estacionalidad: Historico trimestral de Población Económicamente Activa (PEA) en México

Tenemos data trimestral de Enero de 2005 a Agosto de 2022 sobre la Población Económicamente activa en México, son 72 datos en total. 
La idea es usar 66 de esos 72 como una especie de "data de entrenamiento" para aplicar los modelos A) ARIMA y B) SARIMA para posteriormente predecir con cada modelo los valores de los 6 trimestres restantes y poder comparar contra los reales e identificar el mejor entre los dos mencionados para modelar La Poblacion económicamente activa en México 


Primero importamos la data de PEA en MEX
Data obtenida de la página oficial del INEGI:  https://www.inegi.org.mx/temas/empleo/

```{r}

library("readxl")

PEA_mex <-read_excel("PEA_MEX_full.xlsx")
```


Revisamos que la data se hay importado correctamente 
```{r}
PEA_mex
summary(PEA_mex)
typeof(PEA_mex)
dim(PEA_mex)
```




#### Convertimos los data importada a Serie de tiempo 

```{r}

PEA_mex_ts<- ts(PEA_mex$PEA, frequency = 4)
head(PEA_mex_ts)
typeof(PEA_mex_ts)

```


Graficamos la serie del tiempo
```{r}
plot(PEA_mex_ts, col = "blue", main = "Data historica trimestral de PEA en México de 2005 a 2022", ylab="Número de accidentes")

```



### Vamos a descomponer la data usando el metodo decompose para entender sus componentes de tren, seasonalidad y aleatorio de la Serie 2 (PEA en México)

```{r}
PEA_mex_ts_decompose <- decompose(PEA_mex_ts)
summary(PEA_mex_ts_decompose)
```

Vamos a plotear la desmposición 

```{r}
plot(PEA_mex_ts_decompose)
```

Se observa claramente una tendencia creciente (excepto en años 2020 y 2021 derivado de pandemia de Covid-19). Se observa una estacionalidad por 4trimestres donde el 1er cuatrimestre de cada año es el más bajo y e último el más alto. 



### Analicemos los valores de la variable Y 

```{r}
hist(PEA_mex_ts)
```



```{r}
summary(PEA_mex_ts)
```



```{r}

library(e1071)

# Calculate skewness
skewness_value_serie_PEA <- skewness(PEA_mex_ts)

# Calculate kurtosis
kurtosis_value_serie_PEA <- kurtosis(PEA_mex_ts)

# Print the results
print(paste("Skewness:", skewness_value_serie_PEA))
print(paste("Kurtosis:", kurtosis_value_serie_PEA))

```



Se observa que la gran mayoria de los valores de la variable y están en el intervalo de [51 - 56 millones] y que la variable puede seguir una distribución 'Aproximadamente normal con una ligera "skewness" hacia la cola derecha y 'colas pesadas'    



#### Separamos el en data sets train y test de la Serie 2 (PEA en México)

Se tienen 72 datos, por lo que el train será de 66 datos, para que el test sea de 6 datos o 6 trimestres 

```{r}

# Split the data into training and testing sets


# Subset the data to keep rows from the beginning until train_end and all columns
PEA_mex_ts_train <- PEA_mex_ts[1:66]
head(PEA_mex_ts_train)
tail(PEA_mex_ts_train)


```



```{r}
# Subset the data to keep rows from the beginning until train_end and all columns


# Subset the data to keep rows from the beginning until train_end and all columns
PEA_mex_ts_test <- PEA_mex_ts[67:72]
head(PEA_mex_ts_test)
tail(PEA_mex_ts_test)

```





## Modelo SARIMA para Serie 2 (PEA en México)

#### Determinación de ACF & PACF para el caso de la Serie 2 (PEA en México) sin diferneciar 

```{r}
#install.packages("forecast")
library(forecast)

#par(mfrow=c(2,1))

acf_PEA_mex_ts_sin_diferenciar <- Acf(PEA_mex_ts, lag.max = 100, ci.type = "ma")
acf_PEA_mex_ts_sin_diferenciar


pacf_PEA_mex_ts_sin_diferenciar <- Pacf(PEA_mex_ts, lag.max = 100, ci.type = "ma")
pacf_PEA_mex_ts_sin_diferenciar

```
La gráfica de ACF indica que la serie No es una serie estacionaria, para estar 100% seguros heremos un test de Dickey-Fuller  



#### Se lleva a cabo el tet de Dickey-Fulley (Ho: Serie no estacionaria) de la Serie 2 (PEA en México)  <sin diferenciar>

```{r}
# Install and load the "urca" package
#install.packages("urca")
library(urca)

# Perform ADF test for stationarity
acf_test_PEA_mex_ts_sin_diferenciar <- ur.df(PEA_mex_ts)

# Print the ADF test results
summary(acf_test_PEA_mex_ts_sin_diferenciar)

```
Se observa como el valor p de la prueba DF de estacionariedad p> 0.05 por lo tanto NO se rechaza Ho que indica que la serie no es estacionaria. 


Para intentar "hacer estacionaria la serie vamos a tomar la primer diferencia de Yt con Yt-1"


#### Vamos a diferenciar la Serie 2 (PEA en México)  'para hacerlo estacionaria'

```{r}
# Calculate the difference between consecutive elements
PEA_mex_ts_diferencia1 <- diff(PEA_mex_ts, differences = 1)

# Print the results
print(PEA_mex_ts_diferencia1)

```



#### ACF & PACF para de la Serie 2 (PEA en México)  con diferencia1 'estacionariazada'


```{r}
library(forecast)

#par(mfrow=c(2,1))

acf_test_PEA_mex_ts_diferencia1 <- Acf(PEA_mex_ts_diferencia1, lag.max = 100, ci.type = "ma")
acf_test_PEA_mex_ts_diferencia1


pacf_test_PEA_mex_ts_diferencia1 <- Pacf(PEA_mex_ts_diferencia1, lag.max = 100, ci.type = "ma")
pacf_test_PEA_mex_ts_diferencia1
```

Todo indica que la primer diferenciación de la seria ayudó a hacerla estacionaria. Se hace nuevamente una prueba de Dickey-Fulley para verificar estacionariedad 


#### Se lleva a cabo el tet de Dickey-Fulley (Ho: Serie no estacionaria) a la Serie 2 (PEA en México)  <diferenciar 1>

```{r}
# Install and load the "urca" package
#install.packages("urca")
library(urca)

# Perform ADF test for stationarity
acf_test_PEA_mex_ts_diferencia1 <- ur.df(PEA_mex_ts_diferencia1)

# Print the ADF test results
summary(acf_test_PEA_mex_ts_diferencia1)

```

Con un valor de p<0.05 se comprueba que la serie con 1 diferencia ya es estacionaria. 


Con base en las gráficas de ACF y PACF se decide probar un modleo ARIMA (2,1,1)


#### Ajustae y predicicon de para la Serie 2 (PEA en México) con modelo ARIMA 


```{r}
#install.packages("astsa")
library(astsa)

# Fit the SARIMA model
ARIMA_2_1_1_PEA_mex_ts <- astsa::sarima(PEA_mex_ts_train , p=2, d=1, q=1)

# Print the model summary
summary(ARIMA_2_1_1_PEA_mex_ts)

```
En general se observa para el modelo ARIMA_2_1_1_PEA_mex_ts: 

Los errores estandarizados tienen un compartiempo aprorximadamente normal con media cero 
Los errores estandarizados no tiene una correlación signifcativa


#### Calculo de predicción del ARIMA para la Serie 2 (PEA en México)

```{r}

# Get the predictors


pred_ARIMA_2_1_1_PEA_mex_ts <- sarima.for(PEA_mex_ts_train, n.ahead=6,2,1,1)
pred_ARIMA_2_1_1_PEA_mex_ts


```




```{r}
pred_ARIMA_2_1_1_PEA_mex_ts$pred
```




#### Calculo de errores del modelo ARIMA  para la Serie 2 (PEA en México)

```{r}
accuracy(PEA_mex_ts_test ,pred_ARIMA_2_1_1_PEA_mex_ts$pred )
```

El MAPE del modelo ARIMA 2,1,1 para la Serie 2 (PEA en México)  es de 2.71% 

#### Ajustae y predicicon con modelo SARIMA  para la Serie 2 (PEA en México) 


```{r}
#install.packages("astsa")
library(astsa)

# Fit the SARIMA model
SARIMA_PEA_mex_ts <- Arima(PEA_mex_ts_train, order = c(2, 1, 1), seasonal = list(order = c(0, 1, 0), period = 4))

# Print the model summary
summary(SARIMA_PEA_mex_ts)

```


#### Calculo de predicción del SARIMA para la Serie 2 (PEA en México)

```{r}

# Get the predictors


pred_SARIMA_PEA_mex_ts <- forecast(SARIMA_PEA_mex_ts, h = 6)
pred_SARIMA_PEA_mex_ts


```




```{r}
pred_SARIMA_PEA_mex_ts$mean
```




#### Calculo de errores del modelo SARIMA para la Serie 2 (PEA en México)

```{r}
accuracy(PEA_mex_ts_test ,pred_SARIMA_PEA_mex_ts$mean )
```

El MAPE del modelo SARIMA 1,1,1 (0,1,0) S=4 es de ~5%. 




# Serie de tiempo 3 CON tendencia y CON estacionalidad (Historico mensual de Demanda de Gas Natural para el sector eléctrico en México)

Tenemos data mensual de Enero de 2005 a Agosto de 2022 sobre la demanda de gas natural para el sector eléctrico en México, son 213 datos en total. 
La idea es usar 201 de esos 2013 como una especie de "data de entreaniemto" para aplicar los modelos  A) ARIMA y B) SARIMA para posteriormente predecir con cada modelo los valores de los 3 años restantes y poder comparar contra los reales e identificar el mejor entre los dos mencionados para modelar demanda de gas natural en el sector eléctrico en México 




Primero importamos la data con el gas demandado en el sector electrico
```{r}

Demanda_electrico_importado<-read.csv("Demanda_electrico_2022_full1.csv", header= TRUE)

```




Nos aseguramos que la data con el gas demandado en el sector electrico se haya importado correctamente
```{r}
head(Demanda_electrico_importado)
summary(Demanda_electrico_importado)
typeof(Demanda_electrico_importado)
dim(Demanda_electrico_importado)
```


Transformamos el tipo de dato de la columna DATE  a as.date column 

```{r}
Demanda_electrico_importado$Date <- as.Date(Demanda_electrico_importado$Date, format = "%m/%d/%Y")
head(Demanda_electrico_importado)
tail(Demanda_electrico_importado)
typeof(Demanda_electrico_importado)
Demanda_electrico_importado

```



#### Convertimos los data importada a Serie de tiempo 

```{r}

Demanda_electrico_ts<- ts(Demanda_electrico_importado$Demanded_Gas, frequency = 12)
head(Demanda_electrico_ts)
typeof(Demanda_electrico_ts)

```


Graficamos la serie del tiempo
```{r}
plot(Demanda_electrico_ts, col = "green", main = "Data historica mensual de Demanda de Gas Natural para el sector eléctrico en México de 2005 a 2022", cex.main=0.85, ylab="Gas Demandado MMpcd")

```



### Vamos a descomponer la data usando el metodo decompose para entender sus componentes de tren, seasonalidad y aleatorio de la Serie 3 (Demanda de Gas Natural en sector eléctrico en México)

```{r}
Demanda_electrico_ts_decompose <- decompose(Demanda_electrico_ts)
summary(Demanda_electrico_ts_decompose)
```

Vamos a plotear la desmposición 

```{r}
plot(Demanda_electrico_ts_decompose)
```

Se observa claramente una tendencia creciente (excepto en años 2020 y 2021 derivado de pandemia de Covid-19). Se observa una estacionalidad en donde hay una "subida los primeros 6 meses", se llega asu máximo en el mes 07-08 y una bajada los meses 09, 10 y 11.  



### Analicemos los valores de la variable Y 

```{r}
hist(Demanda_electrico_ts)
```



```{r}
summary(Demanda_electrico_ts)
```



```{r}

library(e1071)

# Calculate skewness
skewness_value_serie_Demanda_electrico <- skewness(Demanda_electrico_ts)

# Calculate kurtosis
kurtosis_value_serie_Demanda_electrico <- kurtosis(Demanda_electrico_ts)

# Print the results
print(paste("Skewness:", skewness_value_serie_Demanda_electrico))
print(paste("Kurtosis:", kurtosis_value_serie_Demanda_electrico))

```


Se observa que la gran mayoria de los valores de la variable y están en el intervalo de [2,500 - 3,500 Mpcd] y que la variable puede seguir una distribución 'Aproximadamente normal con una ligera "skewness" hacia la cola derecha 



#### Separamos training and testing sets DE LA SERIE 3 (Demanda_electrico) para aplicar modeo ARIMA & SARIMA   

```{r}

# Split the data into training and testing sets


# Subset the data to keep rows from the beginning until train_end and all columns
Demanda_electrico_original_train <- Demanda_electrico_ts[1:201]
Demanda_electrico_original_train



```



```{r}
# Subset the data to keep rows from the beginning until train_end and all columns


Demanda_electrico_original_test <- Demanda_electrico_ts[202:213]
Demanda_electrico_original_test



```



## Modelo SARIMA para Serie 3 (Demanda_electrico México)


#### Determinación de ACF & PACF para el caso de la Serie 3 (Demanda_electrico México) sin diferneciar 

```{r}
#install.packages("forecast")
library(forecast)

#par(mfrow=c(2,1))

acf_Demanda_electrico_ts_sin_diferenciar <- Acf(Demanda_electrico_ts, lag.max = 100, ci.type = "ma")
acf_Demanda_electrico_ts_sin_diferenciar


pacf_Demanda_electrico_ts_sin_diferenciar <- Pacf(Demanda_electrico_ts, lag.max = 100, ci.type = "ma")
pacf_Demanda_electrico_ts_sin_diferenciar

```
La gráfica de ACF indica claramente que la serie No es una serie estacionaria, para estar 100% seguros heremos un test de Dickey-Fuller  



#### Se lleva a cabo el tet de Dickey-Fulley (Ho: Serie no estacionaria) de la Serie 3 (Demanda_electrico México)  <sin diferenciar>

```{r}
# Install and load the "urca" package
#install.packages("urca")
library(urca)

# Perform ADF test for stationarity
acf_test_Demanda_electrico_ts_sin_diferenciar <- ur.df(Demanda_electrico_ts)

# Print the ADF test results
summary(acf_test_Demanda_electrico_ts_sin_diferenciar)

```
Se observa como el valor p de la prueba DF de estacionariedad p> 0.05 por lo tanto NO se rechaza Ho que indica que la serie no es estacionaria. 

Para intentar "hacer estacionaria la serie vamos a tomar la primer diferencia de Yt con Yt-1"


#### Vamos a diferenciar la Serie 3 (Demanda_electrico México)  'para hacerlo estacionaria'

```{r}
# Calculate the difference between consecutive elements
Demanda_electrico_ts_diferencia1 <- diff(Demanda_electrico_ts, differences = 1)

# Print the results
print(Demanda_electrico_ts_diferencia1)

```



#### ACF & PACF para de la Serie 3 (Demanda_electrico México) con diferencia1 'estacionariazada'


```{r}
library(forecast)

#par(mfrow=c(2,1))

acf_test_Demanda_electrico_ts_diferencia1 <- Acf(Demanda_electrico_ts_diferencia1, lag.max = 100, ci.type = "ma")
acf_test_Demanda_electrico_ts_diferencia1


pacf_test_Demanda_electrico_ts_diferencia1 <- Pacf(Demanda_electrico_ts_diferencia1, lag.max = 100, ci.type = "ma")
pacf_test_Demanda_electrico_ts_diferencia1
```

Todo indica que la primer diferenciación de la seria ayudó a hacerla estacionaria. Se hace nuevamente una prueba de Dickey-Fulley para verificar estacionariedad 


#### Se lleva a cabo el tet de Dickey-Fulley (Ho: Serie no estacionaria) a la Serie 3 (Demanda_electrico México) <diferenciar 1>

```{r}
# Install and load the "urca" package
#install.packages("urca")
library(urca)

# Perform ADF test for stationarity
acf_test_Demanda_electrico_ts_diferencia1 <- ur.df(Demanda_electrico_ts_diferencia1)

# Print the ADF test results
summary(acf_test_Demanda_electrico_ts_diferencia1)

```

Con un valor de p<0.05 se comprueba que la serie con 1 diferencia ya es estacionaria. 


Con base en las gráficas de ACF y PACF se decide probar un modleo ARIMA (1,1,1)


#### Ajuste y predicicon de para la serie 3 (Demanda_electrico México) con modelo ARIMA 


```{r}
#install.packages("astsa")
library(astsa)

# Fit the SARIMA model
ARIMA_1_1_1_Demanda_electrico_original_ts <- astsa::sarima(Demanda_electrico_original_train , p=1, d=1, q=1)

# Print the model summary
summary(ARIMA_1_1_1_Demanda_electrico_original_ts)

```
En general se observa para el modelo ARIMA_1_1_1_Demanda_electrico_original_ts: 

Los errores estandarizados tienen un compartiempo aprorximadamente normal con media cero 
Los errores estandarizados no tiene una correlación signifcativa


#### Calculo de predicción del ARIMA para la serie 3 (Demanda_electrico México)

```{r}

# Get the predictors


pred_ARIMA_1_1_1_Demanda_electrico_original_ts <- sarima.for(Demanda_electrico_original_train, n.ahead=12,1,1,1)
pred_ARIMA_1_1_1_Demanda_electrico_original_ts


```




```{r}
pred_ARIMA_1_1_1_Demanda_electrico_original_ts$pred
```




#### Calculo de errores del modelo ARIMA  para la serie 3 (Demanda_electrico México)

```{r}
accuracy(Demanda_electrico_original_test ,pred_ARIMA_1_1_1_Demanda_electrico_original_ts$pred)
```















#### Ajustae y predicicon de Demanda_electrico con modelo SARIMA + PDQ S

```{r}
library(forecast)


# Fit the SARIMA model
SARIMA_PDQS_Demanda_electrico_V1_model <- Arima(Demanda_electrico_original_train, order = c(1, 1, 1), seasonal = list(order = c(0, 1, 1), period = 12))

# Forecast for the next 12 periods
forecast_SARIMA_PDQS_Demanda_electrico_V1_model <- forecast(SARIMA_PDQS_Demanda_electrico_V1_model, h = 12)

# Print the forecasted values
print(forecast_SARIMA_PDQS_Demanda_electrico_V1_model)
```


```{r}
forecast_SARIMA_PDQS_Demanda_electrico_V1_model$mean
```


#### Calculo de errores del Demanda_electrico_original.ts con SARIMA + PDQ S

```{r}
accuracy(Demanda_electrico_original_test ,forecast_SARIMA_PDQS_Demanda_electrico_V1_model$mean )
```









